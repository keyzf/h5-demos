import{e as re,r as _,m as de,a as se,i as z,b as ue,t as $e,g as we,o as ke,w as Ce,n as Pe,c as Le,d as G,f as xe,h as Ge,j as y,k as e,l as R,p as g,q as j,s as Me,u as K,v as f,x as Te,F as N,y as O,z as B,A as J,B as ve,C as ae,D as me,E as Ie,G as ne,H as Ee,I as le,J as Ae,K as Re,L as je}from"./vendor-LFP2LVqv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function s(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(l){if(l.ep)return;l.ep=!0;const r=s(l);fetch(l.href,r)}})();/*!
 * pinia v2.3.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let he;const Q=n=>he=n,pe=Symbol();function ee(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var F;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(F||(F={}));function Ne(){const n=re(!0),t=n.run(()=>_({}));let s=[],o=[];const l=de({install(r){Q(l),l._a=r,r.provide(pe,l),r.config.globalProperties.$pinia=l,o.forEach(u=>s.push(u)),o=[]},use(r){return this._a?s.push(r):o.push(r),this},_p:s,_a:null,_e:n,_s:new Map,state:t});return l}const fe=()=>{};function ie(n,t,s,o=fe){n.push(t);const l=()=>{const r=n.indexOf(t);r>-1&&(n.splice(r,1),o())};return!s&&we()&&ke(l),l}function H(n,...t){n.slice().forEach(s=>{s(...t)})}const Oe=n=>n(),ce=Symbol(),Z=Symbol();function te(n,t){n instanceof Map&&t instanceof Map?t.forEach((s,o)=>n.set(o,s)):n instanceof Set&&t instanceof Set&&t.forEach(n.add,n);for(const s in t){if(!t.hasOwnProperty(s))continue;const o=t[s],l=n[s];ee(l)&&ee(o)&&n.hasOwnProperty(s)&&!z(o)&&!ue(o)?n[s]=te(l,o):n[s]=o}return n}const We=Symbol();function De(n){return!ee(n)||!n.hasOwnProperty(We)}const{assign:V}=Object;function Ve(n){return!!(z(n)&&n.effect)}function He(n,t,s,o){const{state:l,actions:r,getters:u}=t,d=s.state.value[n];let S;function L(){d||(s.state.value[n]=l?l():{});const M=Le(s.state.value[n]);return V(M,r,Object.keys(u||{}).reduce((T,m)=>(T[m]=de(G(()=>{Q(s);const k=s._s.get(n);return u[m].call(k,k)})),T),{}))}return S=_e(n,L,t,s,o,!0),S}function _e(n,t,s={},o,l,r){let u;const d=V({actions:{}},s),S={deep:!0};let L,M,T=[],m=[],k;const C=o.state.value[n];!r&&!C&&(o.state.value[n]={}),_({});let E;function p(v){let h;L=M=!1,typeof v=="function"?(v(o.state.value[n]),h={type:F.patchFunction,storeId:n,events:k}):(te(o.state.value[n],v),h={type:F.patchObject,payload:v,storeId:n,events:k});const x=E=Symbol();Pe().then(()=>{E===x&&(L=!0)}),M=!0,H(T,h,o.state.value[n])}const $=r?function(){const{state:h}=s,x=h?h():{};this.$patch(W=>{V(W,x)})}:fe;function w(){u.stop(),T=[],m=[],o._s.delete(n)}const I=(v,h="")=>{if(ce in v)return v[Z]=h,v;const x=function(){Q(o);const W=Array.from(arguments),D=[],Y=[];function ge(A){D.push(A)}function Se(A){Y.push(A)}H(m,{args:W,name:x[Z],store:i,after:ge,onError:Se});let q;try{q=v.apply(this&&this.$id===n?this:i,W)}catch(A){throw H(Y,A),A}return q instanceof Promise?q.then(A=>(H(D,A),A)).catch(A=>(H(Y,A),Promise.reject(A))):(H(D,q),q)};return x[ce]=!0,x[Z]=h,x},b={_p:o,$id:n,$onAction:ie.bind(null,m),$patch:p,$reset:$,$subscribe(v,h={}){const x=ie(T,v,h.detached,()=>W()),W=u.run(()=>Ce(()=>o.state.value[n],D=>{(h.flush==="sync"?M:L)&&v({storeId:n,type:F.direct,events:k},D)},V({},S,h)));return x},$dispose:w},i=se(b);o._s.set(n,i);const c=(o._a&&o._a.runWithContext||Oe)(()=>o._e.run(()=>(u=re()).run(()=>t({action:I}))));for(const v in c){const h=c[v];if(z(h)&&!Ve(h)||ue(h))r||(C&&De(h)&&(z(h)?h.value=C[v]:te(h,C[v])),o.state.value[n][v]=h);else if(typeof h=="function"){const x=I(h,v);c[v]=x,d.actions[v]=h}}return V(i,c),V($e(i),c),Object.defineProperty(i,"$state",{get:()=>o.state.value[n],set:v=>{p(h=>{V(h,v)})}}),o._p.forEach(v=>{V(i,u.run(()=>v({store:i,app:o._a,pinia:o,options:d})))}),C&&r&&s.hydrate&&s.hydrate(i.$state,C),L=!0,M=!0,i}/*! #__NO_SIDE_EFFECTS__ */function be(n,t,s){let o,l;const r=typeof t=="function";typeof n=="string"?(o=n,l=r?s:t):(l=n,o=n.id);function u(d,S){const L=Ge();return d=d||(L?xe(pe,null):null),d&&Q(d),d=he,d._s.has(o)||(r?_e(o,t,l,d):He(o,l,d)),d._s.get(o)}return u.$id=o,u}const X=(n,t)=>{const s=n.__vccOpts||n;for(const[o,l]of t)s[o]=l;return s},Be={class:"navigation"},qe={class:"nav-buttons"},Fe={__name:"Navigation",setup(n){return(t,s)=>(g(),y("div",Be,[e("div",qe,[e("button",{class:R(["nav-btn",{active:t.$route.name==="Game"}]),onClick:s[0]||(s[0]=o=>t.$router.push("/"))}," 🎮 游戏客户端 ",2),e("button",{class:R(["nav-btn",{active:t.$route.name==="Leaderboard"}]),onClick:s[1]||(s[1]=o=>t.$router.push("/leaderboard"))}," 📺 大屏终端 ",2),e("button",{class:R(["nav-btn",{active:t.$route.name==="Admin"}]),onClick:s[2]||(s[2]=o=>t.$router.push("/admin"))}," ⚙️ 管理员 ",2)])]))}},Ue=X(Fe,[["__scopeId","data-v-0edf50c2"]]),ze={id:"app"},Je={__name:"App",setup(n){return(t,s)=>{const o=Me("router-view");return g(),y("div",ze,[j(Ue),j(o)])}}},Ke={class:"status-bar"},Qe={class:"time"},Xe={__name:"StatusBar",setup(n){const t=_("06:58"),s=()=>{const o=new Date,l=o.getHours().toString().padStart(2,"0"),r=o.getMinutes().toString().padStart(2,"0");t.value=`${l}:${r}`};return K(()=>{s(),setInterval(s,6e4)}),(o,l)=>(g(),y("div",Ke,[e("div",Qe,f(t.value),1),l[0]||(l[0]=e("div",{class:"status-icons"},[e("div",{class:"signal"}),e("div",{class:"wifi"}),e("div",{class:"battery"},"59")],-1))]))}},U=be("game",()=>{const n=_("请准备"),t=_(0),s=_(30),o=_(!1);return{gameStatus:n,score:t,timeLeft:s,isPlaying:o,updateGameStatus:m=>{n.value=m},updateScore:m=>{t.value=m},updateTime:m=>{s.value=m},setPlaying:m=>{o.value=m},addShakeAnimation:()=>{const m=document.querySelector(".main-rabbit");m&&(m.classList.add("animate-shake"),setTimeout(()=>{m.classList.remove("animate-shake")},200))},showRandomRabbit:()=>{const m=document.querySelectorAll(".hidden-rabbit");if(m.length>0){const k=Math.floor(Math.random()*m.length),C=m[k];C.style.opacity="1",C.classList.add("animate-jump"),setTimeout(()=>{C.style.opacity="0.3",C.classList.remove("animate-jump")},1e3)}},showMessage:m=>{const k=document.querySelector(".status-text");if(k){const C=k.textContent;k.textContent=m,setTimeout(()=>{k.textContent=C},2e3)}},resetGame:()=>{t.value=0,s.value=30,o.value=!1,n.value="请准备",document.querySelectorAll(".hidden-rabbit").forEach(m=>{m.style.opacity="0.3",m.classList.remove("animate-jump")})}}}),Ye={class:"game-header"},Ze={__name:"GameHeader",setup(n){const t=U(),s=Te(),o=()=>{t.showMessage("返回功能")},l=()=>{s.push("/leaderboard")};return(r,u)=>(g(),y("div",Ye,[e("div",{class:"back-btn",onClick:o},"×"),u[0]||(u[0]=e("div",{class:"title"},[e("h1",null,"兔飞猛进"),e("div",{class:"url"},"client.sessionhd.com")],-1)),e("div",{class:"menu-btn",onClick:l},"⋯")]))}},et={class:"scene"},tt={class:"landscape"},st={class:"houses"},nt={class:"trees"},ot={__name:"GameScene",setup(n){const t=s=>({left:(s-1)*12+"%"});return(s,o)=>(g(),y("div",et,[o[1]||(o[1]=e("div",{class:"sky"},[e("div",{class:"clouds"}),e("div",{class:"birds"})],-1)),e("div",tt,[o[0]||(o[0]=e("div",{class:"mountains"},null,-1)),e("div",st,[(g(),y(N,null,O(6,l=>e("div",{class:"house",key:l},[(g(),y(N,null,O(4,r=>e("div",{class:"window",key:r})),64))])),64))]),e("div",nt,[(g(),y(N,null,O(8,l=>e("div",{class:"tree",key:l,style:B(t(l))},null,4)),64))])])]))}},at={class:"game-ui"},lt={class:"game-stats"},it={class:"timer"},ct={class:"time"},rt={class:"score"},dt={class:"points"},ut={__name:"GameUI",setup(n){const t=U(),s=G(()=>t.timeLeft),o=G(()=>t.score),l=r=>{const u=Math.floor(r/60),d=r%60;return`${u.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`};return(r,u)=>(g(),y("div",at,[u[2]||(u[2]=e("div",{class:"player-info"},[e("div",{class:"avatar"},"Drivellsten"),e("div",{class:"username"},"zee")],-1)),e("div",lt,[e("div",it,[u[0]||(u[0]=e("span",{class:"icon"},"⏰",-1)),e("span",ct,f(l(s.value)),1)]),e("div",rt,[u[1]||(u[1]=e("span",{class:"icon"},"⭐",-1)),e("span",dt,f(o.value),1)])])]))}},vt={class:"underground"},mt={class:"rabbits-container"},ht={class:"game-status"},pt={class:"status-text"},ft={__name:"Underground",setup(n){const t=U(),s=G(()=>t.gameStatus),o=[{style:{left:"20%",top:"30%"}},{style:{left:"80%",top:"40%"}},{style:{left:"40%",top:"70%"}},{style:{left:"60%",top:"60%"}}];return(l,r)=>(g(),y("div",vt,[e("div",mt,[r[0]||(r[0]=e("div",{class:"rabbit main-rabbit"},[e("div",{class:"carrot"},"🥕")],-1)),(g(),y(N,null,O(o,(u,d)=>e("div",{class:"rabbit hidden-rabbit",key:d,style:B(u.style)},null,4)),64))]),e("div",ht,[e("div",pt,f(s.value),1)])]))}},_t={class:"bottom-nav"},bt={__name:"BottomNav",setup(n){const t=U(),s=()=>{t.showMessage("返回主页")};return(o,l)=>(g(),y("div",_t,[e("div",{class:"home-btn",onClick:s},"🏠")]))}},yt={class:"modal-content"},gt={class:"modal-buttons"},St={__name:"PermissionModal",props:{show:{type:Boolean,default:!1}},emits:["update:show","allow","cancel"],setup(n){return(t,s)=>J((g(),y("div",{class:"modal",onClick:s[2]||(s[2]=me(o=>t.$emit("update:show",!1),["self"]))},[e("div",yt,[s[3]||(s[3]=e("div",{class:"modal-text"},[ae(' "client.sessionhd.com"'),e("br"),ae(" 想要访问动作与方向 ")],-1)),e("div",gt,[e("button",{class:"btn-cancel",onClick:s[0]||(s[0]=o=>t.$emit("cancel"))},"取消"),e("button",{class:"btn-allow",onClick:s[1]||(s[1]=o=>t.$emit("allow"))},"允许")])])],512)),[[ve,n.show]])}},$t={class:"modal-content"},wt={class:"modal-footer"},kt={__name:"GameOverModal",props:{show:{type:Boolean,default:!1},score:{type:Number,default:0}},emits:["update:show","restart"],setup(n){return(t,s)=>J((g(),y("div",{class:"modal game-over-modal",onClick:s[1]||(s[1]=me(o=>t.$emit("update:show",!1),["self"]))},[e("div",$t,[s[2]||(s[2]=Ie('<div class="modal-header"><div class="header-text">游戏结束</div></div><div class="modal-body"><div class="result"><span class="star">⭐</span><span class="label">本轮排名</span><div class="ranking">第 1 名</div></div></div>',2)),e("div",wt,[e("button",{class:"btn-view-ranking",onClick:s[0]||(s[0]=o=>t.$emit("restart"))},"查看排名 >>")])])],512)),[[ve,n.show]])}};class Ct{constructor(){this.ws=null,this.clientId=null,this.clientType=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.messageHandlers=new Map}connect(t="client"){const s=window.location.protocol==="https:"?"wss:":"ws:",o=window.location.hostname,l=window.location.port||(window.location.protocol==="https:"?"443":"80"),r=`${s}//${o}:${l}`;this.clientType=t;try{this.ws=new WebSocket(r),this.setupEventHandlers()}catch(u){console.error("WebSocket连接失败:",u),this.scheduleReconnect()}}setupEventHandlers(){this.ws.onopen=()=>{console.log("WebSocket连接已建立"),this.isConnected=!0,this.reconnectAttempts=0},this.ws.onmessage=t=>{try{const s=JSON.parse(t.data);this.handleMessage(s)}catch(s){console.error("消息解析错误:",s)}},this.ws.onclose=t=>{console.log("WebSocket连接已关闭:",t.code,t.reason),this.isConnected=!1,t.wasClean||this.scheduleReconnect()},this.ws.onerror=t=>{console.error("WebSocket错误:",t)}}handleMessage(t){console.log("收到消息:",t);const s=this.messageHandlers.get(t.type);s&&s(t.data)}send(t,s={}){if(this.ws&&this.ws.readyState===WebSocket.OPEN){const o={type:t,...s};this.ws.send(JSON.stringify(o))}else console.warn("WebSocket未连接，无法发送消息")}on(t,s){this.messageHandlers.set(t,s)}off(t){this.messageHandlers.delete(t)}joinGame(t,s){this.send("player_join",{name:t,team:s})}updatePlayer(t){this.send("player_update",t)}startGame(t=30){this.send("game_start",{timeLeft:t})}endGame(){this.send("game_end")}resetGame(){this.send("game_reset")}shakeDetected(){this.send("shake_detected")}scheduleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`尝试重连 (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),setTimeout(()=>{this.connect(this.clientType)},this.reconnectDelay*this.reconnectAttempts)):console.error("达到最大重连次数，停止重连")}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1}getConnectionStatus(){return{isConnected:this.isConnected,clientId:this.clientId,clientType:this.clientType}}}const P=new Ct,Pt={class:"game-container"},Lt={key:0,class:"offline-notice"},xt={class:"game-main"},Gt=15,Mt=500,Tt={__name:"GameView",setup(n){const t=U(),s=_(!0),o=_(!1),l=_(!1),r=_("离线模式"),u=_(!0),d=se({score:0,timeLeft:30,shakeCount:0,isPlaying:!1,playerId:null,playerName:"zee",playerTeam:"Drivellsten"});let S=0,L=null;const M=()=>{try{P.connect("client"),P.on("connection",c=>{d.playerId=c.clientId,l.value=!0,u.value=!1,r.value="已连接",P.joinGame(d.playerName,d.playerTeam)}),P.on("game_state",c=>{T(c)}),setInterval(()=>{const c=P.getConnectionStatus();l.value=c.isConnected,u.value=!c.isConnected,r.value=c.isConnected?"已连接":"离线模式"},1e3)}catch(a){console.log("WebSocket连接失败，使用离线模式:",a),u.value=!0,r.value="离线模式"}},T=a=>{a.isPlaying!==d.isPlaying&&(d.isPlaying=a.isPlaying,a.isPlaying?C():E()),d.timeLeft=a.timeLeft;const c=a.players.find(v=>v.id===d.playerId);c&&(d.score=c.score,d.shakeCount=Math.floor(c.score/10))},m=()=>{s.value=!1,M()},k=()=>{s.value=!1,t.showMessage("需要权限才能开始游戏")},C=()=>{d.isPlaying=!0,d.score=0,d.shakeCount=0,d.timeLeft=30,t.updateGameStatus("游戏开始！摇动手机收集胡萝卜"),L=setInterval(()=>{d.timeLeft--,d.timeLeft<=0&&E()},1e3)},E=()=>{d.isPlaying=!1,clearInterval(L),t.updateGameStatus("游戏结束"),o.value=!0},p=()=>{o.value=!1,d.score=0,d.shakeCount=0,d.timeLeft=30,t.updateGameStatus("请准备"),document.querySelectorAll(".hidden-rabbit").forEach(a=>{a.style.opacity="0.3",a.classList.remove("jump")})},$=a=>{if(!d.isPlaying)return;const c=a.accelerationIncludingGravity;if(!c)return;const v=c.x,h=c.y,x=c.z,W=Math.sqrt(v*v+h*h+x*x),D=Date.now();W>Gt&&D-S>Mt&&(S=D,w())},w=()=>{d.shakeCount++,d.score+=10,!u.value&&l.value&&P.shakeDetected(),t.addShakeAnimation(),t.showRandomRabbit(),d.shakeCount>=10&&E()},I=()=>{const a=v=>{v.code==="Space"&&d.isPlaying&&(v.preventDefault(),w())},c=v=>{d.isPlaying&&v.target.closest(".underground")&&w()};return document.addEventListener("keydown",a),document.addEventListener("click",c),()=>{document.removeEventListener("keydown",a),document.removeEventListener("click",c)}},b=()=>{if(window.DeviceMotionEvent)window.addEventListener("devicemotion",$);else return I()},i=()=>{u.value&&C()};return K(()=>{const a=b();ne(()=>{a&&a(),L&&clearInterval(L),window.removeEventListener("devicemotion",$),P.disconnect()})}),(a,c)=>(g(),y("div",Pt,[e("div",{class:R(["connection-status",{connected:l.value}])},f(r.value),3),u.value&&!d.isPlaying?(g(),y("div",Lt,[e("div",{class:"offline-content"},[c[2]||(c[2]=e("h3",null,"离线模式",-1)),c[3]||(c[3]=e("p",null,"当前为离线模式，可以测试摇一摇功能",-1)),e("button",{onClick:i,class:"start-btn"}," 开始本地游戏 ")])])):Ee("",!0),j(Xe),j(Ze),e("div",xt,[j(ot),j(ut),j(ft)]),j(bt),j(St,{show:s.value,"onUpdate:show":c[0]||(c[0]=v=>s.value=v),onAllow:m,onCancel:k},null,8,["show"]),j(kt,{show:o.value,"onUpdate:show":c[1]||(c[1]=v=>o.value=v),score:a.score,onRestart:p},null,8,["show","score"])]))}},It=X(Tt,[["__scopeId","data-v-bcc6dfa2"]]),Et=be("leaderboard",()=>{const n=_([]),t=_("waiting"),s=_(30),o=_(0),l=G(()=>[...n.value].sort((p,$)=>$.score-p.score)),r=G(()=>n.value.filter(p=>p.score>0).length),u=G(()=>{const p=n.value.filter(w=>w.score>0);if(p.length===0)return 0;const $=p.reduce((w,I)=>w+I.score,0);return Math.round($/p.length)}),d=p=>{n.value.find(w=>w.id===p.id)||n.value.push({id:p.id,name:p.name,team:p.team,score:0,progress:0,track:null})},S=(p,$)=>{const w=n.value.find(I=>I.id===p);w&&(w.score=$,w.progress=Math.min(95,$/100*95),$>o.value&&(o.value=$))},L=()=>{n.value.filter($=>$.score>0).forEach(($,w)=>{$.track=w+1})},M=()=>{n.value.forEach(p=>{p.score=0,p.progress=0,p.track=null}),o.value=0,s.value=30,t.value="waiting"},T=()=>{t.value="playing",s.value=30,L()},m=()=>{t.value="finished"},k=p=>{s.value=p},C=p=>{const w=l.value.findIndex(I=>I.id===p);return w>=0?w+1:null},E=G(()=>l.value.slice(0,3));return{players:n,gameStatus:t,timeLeft:s,maxScore:o,sortedPlayers:l,totalPlayers:r,averageScore:u,getTopThree:E,addPlayer:d,updatePlayerScore:S,assignTracks:L,resetGame:M,startGame:T,endGame:m,updateTime:k,getPlayerRank:C}}),At={class:"leaderboard-container"},Rt={class:"header"},jt={class:"game-status"},Nt={class:"timer"},Ot={class:"time"},Wt={class:"race-track"},Dt={class:"track-container"},Vt={class:"track-background"},Ht={class:"houses"},Bt={class:"trees"},qt={class:"track-number"},Ft={class:"player-info"},Ut={class:"player-name"},zt={class:"player-score"},Jt={class:"leaderboard"},Kt={class:"leaderboard-header"},Qt={class:"total-players"},Xt={class:"leaderboard-list"},Yt={class:"rank"},Zt={class:"player-details"},es={class:"player-name"},ts={class:"player-team"},ss={class:"player-score"},ns={class:"player-progress"},os={class:"progress-bar"},as={class:"control-panel"},ls={class:"control-buttons"},is=["disabled"],cs={class:"game-stats"},rs={class:"stat"},ds={class:"value"},us={class:"stat"},vs={class:"value"},ms={class:"stat"},hs={class:"value"},ps={__name:"LeaderboardView",setup(n){Et();const t=_(!1),s=_(30),o=_("waiting"),l=_("等待开始"),r=_(!1),u=_("连接中..."),d=se(Array.from({length:8},(b,i)=>({id:i+1,player:null,progress:0}))),S=_([]),L=G(()=>[...S.value].sort((b,i)=>i.score-b.score)),M=G(()=>S.value.filter(b=>b.score>0).length),T=G(()=>Math.max(...S.value.map(b=>b.score),0)),m=G(()=>{const b=S.value.filter(a=>a.score>0);if(b.length===0)return 0;const i=b.reduce((a,c)=>a+c.score,0);return Math.round(i/b.length)}),k=b=>{const i=Math.floor(b/60),a=b%60;return`${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`},C=()=>{P.connect("leaderboard"),P.on("connection",i=>{r.value=!0,u.value="已连接",i.gameState&&E(i.gameState)}),P.on("game_state",i=>{E(i)}),setInterval(()=>{const i=P.getConnectionStatus();r.value=i.isConnected,u.value=i.isConnected?"已连接":"连接断开"},1e3)},E=b=>{t.value=b.isPlaying,s.value=b.timeLeft,b.isPlaying?(o.value="playing",l.value="游戏进行中"):(o.value="waiting",l.value="等待开始"),S.value=b.players||[],p()},p=()=>{d.forEach((b,i)=>{const a=S.value.find(c=>c.track===i+1);b.player=a||null,b.progress=a?a.progress:0})},$=()=>{t.value||P.startGame(30)},w=()=>{P.resetGame()},I=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()};return K(()=>{C()}),ne(()=>{P.disconnect()}),(b,i)=>(g(),y("div",At,[e("div",{class:R(["connection-status",{connected:r.value}])},f(u.value),3),e("div",Rt,[i[1]||(i[1]=e("div",{class:"title"},[e("h1",null,"兔飞猛进 - 实时排行榜"),e("div",{class:"subtitle"},"实时显示所有参赛选手的摇一摇积分排名")],-1)),e("div",jt,[e("div",{class:R(["status-indicator",o.value])},f(l.value),3),e("div",Nt,[i[0]||(i[0]=e("span",{class:"icon"},"⏰",-1)),e("span",Ot,f(k(s.value)),1)])])]),e("div",Wt,[i[4]||(i[4]=e("div",{class:"sky"},[e("div",{class:"clouds"}),e("div",{class:"birds"})],-1)),i[5]||(i[5]=e("div",{class:"mountains"},null,-1)),e("div",Dt,[(g(!0),y(N,null,O(d,(a,c)=>{var v,h;return g(),y("div",{class:"track",key:c,style:B({top:`${c*80+100}px`})},[e("div",Vt,[e("div",Ht,[(g(),y(N,null,O(8,x=>e("div",{class:"house",key:x})),64))]),e("div",Bt,[(g(),y(N,null,O(6,x=>e("div",{class:"tree",key:x})),64))])]),e("div",qt,f(c+1),1),e("div",{class:R(["player-rabbit",{active:a.player}]),style:B({left:`${a.progress}%`})},[i[2]||(i[2]=e("div",{class:"rabbit-avatar"},[e("div",{class:"rabbit-body"}),e("div",{class:"rabbit-ears"}),e("div",{class:"rabbit-face"})],-1)),e("div",Ft,[e("div",Ut,f(((v=a.player)==null?void 0:v.name)||"等待加入"),1),e("div",zt,f(((h=a.player)==null?void 0:h.score)||0)+"分",1)])],6),i[3]||(i[3]=e("div",{class:"finish-line"},null,-1))],4)}),128))])]),e("div",Jt,[e("div",Kt,[i[6]||(i[6]=e("h2",null,"实时排行榜",-1)),e("div",Qt,"参赛人数: "+f(M.value),1)]),e("div",Xt,[(g(!0),y(N,null,O(L.value,(a,c)=>(g(),y("div",{class:R(["leaderboard-item",{"top-3":c<3}]),key:a.id},[e("div",Yt,f(c+1),1),i[7]||(i[7]=e("div",{class:"player-avatar"},[e("div",{class:"mini-rabbit"})],-1)),e("div",Zt,[e("div",es,f(a.name),1),e("div",ts,f(a.team),1)]),e("div",ss,f(a.score)+"分",1),e("div",ns,[e("div",os,[e("div",{class:"progress-fill",style:B({width:`${a.score/T.value*100}%`})},null,4)])])],2))),128))])]),e("div",as,[e("div",ls,[e("button",{class:"btn btn-primary",onClick:$,disabled:t.value},f(t.value?"游戏进行中":"开始游戏"),9,is),e("button",{class:"btn btn-secondary",onClick:w}," 重置游戏 "),e("button",{class:"btn btn-info",onClick:I}," 全屏显示 ")]),e("div",cs,[e("div",rs,[i[8]||(i[8]=e("span",{class:"label"},"最高分:",-1)),e("span",ds,f(T.value)+"分",1)]),e("div",us,[i[9]||(i[9]=e("span",{class:"label"},"平均分:",-1)),e("span",vs,f(m.value)+"分",1)]),e("div",ms,[i[10]||(i[10]=e("span",{class:"label"},"剩余时间:",-1)),e("span",hs,f(k(s.value)),1)])])])]))}},fs=X(ps,[["__scopeId","data-v-759ecc6b"]]),_s={class:"admin-container"},bs={class:"admin-panel"},ys={class:"panel-header"},gs={class:"game-status"},Ss={class:"control-section"},$s={class:"control-buttons"},ws=["disabled"],ks=["disabled"],Cs={class:"settings-section"},Ps={class:"setting-item"},Ls=["disabled"],xs={class:"setting-item"},Gs=["disabled"],Ms={class:"stats-section"},Ts={class:"stats-grid"},Is={class:"stat-card"},Es={class:"stat-value"},As={class:"stat-card"},Rs={class:"stat-value"},js={class:"stat-card"},Ns={class:"stat-value"},Os={class:"stat-card"},Ws={class:"stat-value"},Ds={class:"players-section"},Vs={class:"players-list"},Hs={class:"player-info"},Bs={class:"player-name"},qs={class:"player-team"},Fs={class:"player-stats"},Us={class:"player-score"},zs={class:"player-progress"},Js={class:"progress-bar"},Ks={class:"system-section"},Qs={class:"system-info"},Xs={class:"info-item"},Ys={class:"info-item"},Zs={class:"value"},en={class:"info-item"},tn={class:"value"},sn={__name:"AdminView",setup(n){const t=_(!1),s=_(30),o=_(!1),l=_("连接中..."),r=_("--:--"),u=_(30),d=_(500),S=_([]),L=G(()=>t.value?"游戏进行中":"等待开始"),M=G(()=>t.value?"playing":"waiting"),T=G(()=>S.value.length),m=G(()=>S.value.filter(i=>i.score>0).length),k=G(()=>Math.max(...S.value.map(i=>i.score),0)),C=G(()=>{const i=S.value.filter(c=>c.score>0);if(i.length===0)return 0;const a=i.reduce((c,v)=>c+v.score,0);return Math.round(a/i.length)}),E=i=>{const a=Math.floor(i/60),c=i%60;return`${a.toString().padStart(2,"0")}:${c.toString().padStart(2,"0")}`},p=()=>{P.connect("admin"),P.on("connection",a=>{o.value=!0,l.value="已连接",r.value=new Date().toLocaleTimeString(),a.gameState&&$(a.gameState)}),P.on("game_state",a=>{$(a)}),setInterval(()=>{const a=P.getConnectionStatus();o.value=a.isConnected,l.value=a.isConnected?"已连接":"连接断开"},1e3)},$=i=>{t.value=i.isPlaying,s.value=i.timeLeft,S.value=i.players||[]},w=()=>{P.startGame(u.value)},I=()=>{P.endGame()},b=()=>{P.resetGame()};return K(()=>{p()}),ne(()=>{P.disconnect()}),(i,a)=>(g(),y("div",_s,[e("div",{class:R(["connection-status",{connected:o.value}])},f(l.value),3),e("div",bs,[e("div",ys,[a[3]||(a[3]=e("h1",null,"游戏管理员控制台",-1)),e("div",gs,[a[2]||(a[2]=e("span",{class:"status-label"},"游戏状态:",-1)),e("span",{class:R(["status-value",M.value])},f(L.value),3)])]),e("div",Ss,[a[4]||(a[4]=e("h2",null,"游戏控制",-1)),e("div",$s,[e("button",{class:"btn btn-start",onClick:w,disabled:t.value}," 🎮 开始游戏 ",8,ws),e("button",{class:"btn btn-stop",onClick:I,disabled:!t.value}," ⏹️ 结束游戏 ",8,ks),e("button",{class:"btn btn-reset",onClick:b}," 🔄 重置游戏 ")])]),e("div",Cs,[a[7]||(a[7]=e("h2",null,"游戏设置",-1)),e("div",Ps,[a[5]||(a[5]=e("label",null,"游戏时长 (秒):",-1)),J(e("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=c=>u.value=c),min:"10",max:"300",disabled:t.value},null,8,Ls),[[le,u.value]])]),e("div",xs,[a[6]||(a[6]=e("label",null,"摇一摇冷却时间 (毫秒):",-1)),J(e("input",{type:"number","onUpdate:modelValue":a[1]||(a[1]=c=>d.value=c),min:"100",max:"2000",disabled:t.value},null,8,Gs),[[le,d.value]])])]),e("div",Ms,[a[12]||(a[12]=e("h2",null,"实时统计",-1)),e("div",Ts,[e("div",Is,[e("div",Es,f(T.value),1),a[8]||(a[8]=e("div",{class:"stat-label"},"在线玩家",-1))]),e("div",As,[e("div",Rs,f(m.value),1),a[9]||(a[9]=e("div",{class:"stat-label"},"活跃玩家",-1))]),e("div",js,[e("div",Ns,f(k.value),1),a[10]||(a[10]=e("div",{class:"stat-label"},"最高分数",-1))]),e("div",Os,[e("div",Ws,f(C.value),1),a[11]||(a[11]=e("div",{class:"stat-label"},"平均分数",-1))])])]),e("div",Ds,[a[13]||(a[13]=e("h2",null,"在线玩家",-1)),e("div",Vs,[(g(!0),y(N,null,O(S.value,c=>(g(),y("div",{class:"player-item",key:c.id},[e("div",Hs,[e("div",Bs,f(c.name),1),e("div",qs,f(c.team),1)]),e("div",Fs,[e("div",Us,f(c.score)+"分",1),e("div",zs,[e("div",Js,[e("div",{class:"progress-fill",style:B({width:`${c.progress}%`})},null,4)])])])]))),128))])]),e("div",Ks,[a[17]||(a[17]=e("h2",null,"系统信息",-1)),e("div",Qs,[e("div",Xs,[a[14]||(a[14]=e("span",{class:"label"},"服务器状态:",-1)),e("span",{class:R(["value",{online:o.value}])},f(o.value?"在线":"离线"),3)]),e("div",Ys,[a[15]||(a[15]=e("span",{class:"label"},"连接时间:",-1)),e("span",Zs,f(r.value),1)]),e("div",en,[a[16]||(a[16]=e("span",{class:"label"},"剩余时间:",-1)),e("span",tn,f(E(s.value)),1)])])])])]))}},nn=X(sn,[["__scopeId","data-v-9cf78069"]]),on=[{path:"/",name:"Game",component:It,meta:{title:"兔飞猛进 - 游戏客户端"}},{path:"/leaderboard",name:"Leaderboard",component:fs,meta:{title:"兔飞猛进 - 大屏终端"}},{path:"/admin",name:"Admin",component:nn,meta:{title:"兔飞猛进 - 管理员控制台"}}],ye=Ae({history:Re(),routes:on});ye.beforeEach((n,t,s)=>{n.meta.title&&(document.title=n.meta.title),s()});const oe=je(Je),an=Ne();oe.use(an);oe.use(ye);oe.mount("#app");
