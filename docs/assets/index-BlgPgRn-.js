import{e as de,r as g,m as ve,a as ae,i as X,b as me,t as we,g as $e,o as ke,w as Ce,n as Pe,c as Me,d as E,f as Le,h as xe,j as $,k as e,l as N,p as k,q as O,s as Ge,u as Z,v as h,x as De,F as q,y as W,z as F,A as Y,B as he,C as U,D as fe,E as Ee,G as ie,H as Ie,I as ce,J as Ae,K as Te,L as Re}from"./vendor-LFP2LVqv.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const r of c.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function s(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(i){if(i.ep)return;i.ep=!0;const c=s(i);fetch(i.href,c)}})();/*!
 * pinia v2.3.1
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let pe;const ee=n=>pe=n,_e=Symbol();function ne(n){return n&&typeof n=="object"&&Object.prototype.toString.call(n)==="[object Object]"&&typeof n.toJSON!="function"}var z;(function(n){n.direct="direct",n.patchObject="patch object",n.patchFunction="patch function"})(z||(z={}));function je(){const n=de(!0),t=n.run(()=>g({}));let s=[],o=[];const i=ve({install(c){ee(i),i._a=c,c.provide(_e,i),c.config.globalProperties.$pinia=i,o.forEach(r=>s.push(r)),o=[]},use(c){return this._a?s.push(c):o.push(c),this},_p:s,_a:null,_e:n,_s:new Map,state:t});return i}const ge=()=>{};function re(n,t,s,o=ge){n.push(t);const i=()=>{const c=n.indexOf(t);c>-1&&(n.splice(c,1),o())};return!s&&$e()&&ke(i),i}function B(n,...t){n.slice().forEach(s=>{s(...t)})}const Ne=n=>n(),ue=Symbol(),se=Symbol();function oe(n,t){n instanceof Map&&t instanceof Map?t.forEach((s,o)=>n.set(o,s)):n instanceof Set&&t instanceof Set&&t.forEach(n.add,n);for(const s in t){if(!t.hasOwnProperty(s))continue;const o=t[s],i=n[s];ne(i)&&ne(o)&&n.hasOwnProperty(s)&&!X(o)&&!me(o)?n[s]=oe(i,o):n[s]=o}return n}const Oe=Symbol();function qe(n){return!ne(n)||!n.hasOwnProperty(Oe)}const{assign:V}=Object;function We(n){return!!(X(n)&&n.effect)}function Ve(n,t,s,o){const{state:i,actions:c,getters:r}=t,f=s.state.value[n];let w;function u(){f||(s.state.value[n]=i?i():{});const I=Me(s.state.value[n]);return V(I,c,Object.keys(r||{}).reduce((G,m)=>(G[m]=ve(E(()=>{ee(s);const P=s._s.get(n);return r[m].call(P,P)})),G),{}))}return w=be(n,u,t,s,o,!0),w}function be(n,t,s={},o,i,c){let r;const f=V({actions:{}},s),w={deep:!0};let u,I,G=[],m=[],P;const x=o.state.value[n];!c&&!x&&(o.state.value[n]={}),g({});let j;function _(y){let S;u=I=!1,typeof y=="function"?(y(o.state.value[n]),S={type:z.patchFunction,storeId:n,events:P}):(oe(o.state.value[n],y),S={type:z.patchObject,payload:y,storeId:n,events:P});const D=j=Symbol();Pe().then(()=>{j===D&&(u=!0)}),I=!0,B(G,S,o.state.value[n])}const C=c?function(){const{state:S}=s,D=S?S():{};this.$patch(v=>{V(v,D)})}:ge;function M(){r.stop(),G=[],m=[],o._s.delete(n)}const T=(y,S="")=>{if(ue in y)return y[se]=S,y;const D=function(){ee(o);const v=Array.from(arguments),d=[],A=[];function K(R){d.push(R)}function Q(R){A.push(R)}B(m,{args:v,name:D[se],store:a,after:K,onError:Q});let H;try{H=y.apply(this&&this.$id===n?this:a,v)}catch(R){throw B(A,R),R}return H instanceof Promise?H.then(R=>(B(d,R),R)).catch(R=>(B(A,R),Promise.reject(R))):(B(d,H),H)};return D[ue]=!0,D[se]=S,D},b={_p:o,$id:n,$onAction:re.bind(null,m),$patch:_,$reset:C,$subscribe(y,S={}){const D=re(G,y,S.detached,()=>v()),v=r.run(()=>Ce(()=>o.state.value[n],d=>{(S.flush==="sync"?I:u)&&y({storeId:n,type:z.direct,events:P},d)},V({},w,S)));return D},$dispose:M},a=ae(b);o._s.set(n,a);const p=(o._a&&o._a.runWithContext||Ne)(()=>o._e.run(()=>(r=de()).run(()=>t({action:T}))));for(const y in p){const S=p[y];if(X(S)&&!We(S)||me(S))c||(x&&qe(S)&&(X(S)?S.value=x[y]:oe(S,x[y])),o.state.value[n][y]=S);else if(typeof S=="function"){const D=T(S,y);p[y]=D,f.actions[y]=S}}return V(a,p),V(we(a),p),Object.defineProperty(a,"$state",{get:()=>o.state.value[n],set:y=>{_(S=>{V(S,y)})}}),o._p.forEach(y=>{V(a,r.run(()=>y({store:a,app:o._a,pinia:o,options:f})))}),x&&c&&s.hydrate&&s.hydrate(a.$state,x),u=!0,I=!0,a}/*! #__NO_SIDE_EFFECTS__ */function ye(n,t,s){let o,i;const c=typeof t=="function";typeof n=="string"?(o=n,i=c?s:t):(i=n,o=n.id);function r(f,w){const u=xe();return f=f||(u?Le(_e,null):null),f&&ee(f),f=pe,f._s.has(o)||(c?be(o,t,i,f):Ve(o,i,f)),f._s.get(o)}return r.$id=o,r}const te=(n,t)=>{const s=n.__vccOpts||n;for(const[o,i]of t)s[o]=i;return s},He={class:"navigation"},Be={class:"nav-buttons"},Fe={__name:"Navigation",setup(n){return(t,s)=>(k(),$("div",He,[e("div",Be,[e("button",{class:N(["nav-btn",{active:t.$route.name==="Game"}]),onClick:s[0]||(s[0]=o=>t.$router.push("/"))}," 🎮 游戏客户端 ",2),e("button",{class:N(["nav-btn",{active:t.$route.name==="Leaderboard"}]),onClick:s[1]||(s[1]=o=>t.$router.push("/leaderboard"))}," 📺 大屏终端 ",2),e("button",{class:N(["nav-btn",{active:t.$route.name==="Admin"}]),onClick:s[2]||(s[2]=o=>t.$router.push("/admin"))}," ⚙️ 管理员 ",2)])]))}},Ue=te(Fe,[["__scopeId","data-v-0edf50c2"]]),ze={id:"app"},Je={__name:"App",setup(n){return(t,s)=>{const o=Ge("router-view");return k(),$("div",ze,[O(Ue),O(o)])}}},Ke={class:"status-bar"},Qe={class:"time"},Xe={__name:"StatusBar",setup(n){const t=g("06:58"),s=()=>{const o=new Date,i=o.getHours().toString().padStart(2,"0"),c=o.getMinutes().toString().padStart(2,"0");t.value=`${i}:${c}`};return Z(()=>{s(),setInterval(s,6e4)}),(o,i)=>(k(),$("div",Ke,[e("div",Qe,h(t.value),1),i[0]||(i[0]=e("div",{class:"status-icons"},[e("div",{class:"signal"}),e("div",{class:"wifi"}),e("div",{class:"battery"},"59")],-1))]))}},J=ye("game",()=>{const n=g("请准备"),t=g(0),s=g(30),o=g(!1);return{gameStatus:n,score:t,timeLeft:s,isPlaying:o,updateGameStatus:m=>{n.value=m},updateScore:m=>{t.value=m},updateTime:m=>{s.value=m},setPlaying:m=>{o.value=m},addShakeAnimation:()=>{const m=document.querySelector(".main-rabbit");m&&(m.classList.add("animate-shake"),setTimeout(()=>{m.classList.remove("animate-shake")},200))},showRandomRabbit:()=>{const m=document.querySelectorAll(".hidden-rabbit");if(m.length>0){const P=Math.floor(Math.random()*m.length),x=m[P];x.style.opacity="1",x.classList.add("animate-jump"),setTimeout(()=>{x.style.opacity="0.3",x.classList.remove("animate-jump")},1e3)}},showMessage:m=>{const P=document.querySelector(".status-text");if(P){const x=P.textContent;P.textContent=m,setTimeout(()=>{P.textContent=x},2e3)}},resetGame:()=>{t.value=0,s.value=30,o.value=!1,n.value="请准备",document.querySelectorAll(".hidden-rabbit").forEach(m=>{m.style.opacity="0.3",m.classList.remove("animate-jump")})}}}),Ye={class:"game-header"},Ze={__name:"GameHeader",setup(n){const t=J(),s=De(),o=()=>{t.showMessage("返回功能")},i=()=>{s.push("/leaderboard")};return(c,r)=>(k(),$("div",Ye,[e("div",{class:"back-btn",onClick:o},"×"),r[0]||(r[0]=e("div",{class:"title"},[e("h1",null,"兔飞猛进"),e("div",{class:"url"},"client.sessionhd.com")],-1)),e("div",{class:"menu-btn",onClick:i},"⋯")]))}},et={class:"scene"},tt={class:"landscape"},st={class:"houses"},nt={class:"trees"},ot={__name:"GameScene",setup(n){const t=s=>({left:(s-1)*12+"%"});return(s,o)=>(k(),$("div",et,[o[1]||(o[1]=e("div",{class:"sky"},[e("div",{class:"clouds"}),e("div",{class:"birds"})],-1)),e("div",tt,[o[0]||(o[0]=e("div",{class:"mountains"},null,-1)),e("div",st,[(k(),$(q,null,W(6,i=>e("div",{class:"house",key:i},[(k(),$(q,null,W(4,c=>e("div",{class:"window",key:c})),64))])),64))]),e("div",nt,[(k(),$(q,null,W(8,i=>e("div",{class:"tree",key:i,style:F(t(i))},null,4)),64))])])]))}},at={class:"game-ui"},it={class:"game-stats"},lt={class:"timer"},ct={class:"time"},rt={class:"score"},ut={class:"points"},dt={__name:"GameUI",setup(n){const t=J(),s=E(()=>t.timeLeft),o=E(()=>t.score),i=c=>{const r=Math.floor(c/60),f=c%60;return`${r.toString().padStart(2,"0")}:${f.toString().padStart(2,"0")}`};return(c,r)=>(k(),$("div",at,[r[2]||(r[2]=e("div",{class:"player-info"},[e("div",{class:"avatar"},"Drivellsten"),e("div",{class:"username"},"zee")],-1)),e("div",it,[e("div",lt,[r[0]||(r[0]=e("span",{class:"icon"},"⏰",-1)),e("span",ct,h(i(s.value)),1)]),e("div",rt,[r[1]||(r[1]=e("span",{class:"icon"},"⭐",-1)),e("span",ut,h(o.value),1)])])]))}},vt={class:"underground"},mt={class:"rabbits-container"},ht={class:"game-status"},ft={class:"status-text"},pt={__name:"Underground",setup(n){const t=J(),s=E(()=>t.gameStatus),o=[{style:{left:"20%",top:"30%"}},{style:{left:"80%",top:"40%"}},{style:{left:"40%",top:"70%"}},{style:{left:"60%",top:"60%"}}];return(i,c)=>(k(),$("div",vt,[e("div",mt,[c[0]||(c[0]=e("div",{class:"rabbit main-rabbit"},[e("div",{class:"carrot"},"🥕")],-1)),(k(),$(q,null,W(o,(r,f)=>e("div",{class:"rabbit hidden-rabbit",key:f,style:F(r.style)},null,4)),64))]),e("div",ht,[e("div",ft,h(s.value),1)])]))}},_t={class:"bottom-nav"},gt={__name:"BottomNav",setup(n){const t=J(),s=()=>{t.showMessage("返回主页")};return(o,i)=>(k(),$("div",_t,[e("div",{class:"home-btn",onClick:s},"🏠")]))}},bt={class:"modal-content"},yt={class:"modal-buttons"},St={__name:"PermissionModal",props:{show:{type:Boolean,default:!1}},emits:["update:show","allow","cancel"],setup(n){return(t,s)=>Y((k(),$("div",{class:"modal",onClick:s[2]||(s[2]=fe(o=>t.$emit("update:show",!1),["self"]))},[e("div",bt,[s[3]||(s[3]=e("div",{class:"modal-text"},[U(' "client.sessionhd.com"'),e("br"),U(" 想要访问动作与方向"),e("br"),e("small",null,"用于检测摇一摇功能")],-1)),e("div",yt,[e("button",{class:"btn-cancel",onClick:s[0]||(s[0]=o=>t.$emit("cancel"))},"取消"),e("button",{class:"btn-allow",onClick:s[1]||(s[1]=o=>t.$emit("allow"))},"允许")])])],512)),[[he,n.show]])}},wt={class:"modal-content"},$t={class:"modal-footer"},kt={__name:"GameOverModal",props:{show:{type:Boolean,default:!1},score:{type:Number,default:0}},emits:["update:show","restart"],setup(n){return(t,s)=>Y((k(),$("div",{class:"modal game-over-modal",onClick:s[1]||(s[1]=fe(o=>t.$emit("update:show",!1),["self"]))},[e("div",wt,[s[2]||(s[2]=Ee('<div class="modal-header"><div class="header-text">游戏结束</div></div><div class="modal-body"><div class="result"><span class="star">⭐</span><span class="label">本轮排名</span><div class="ranking">第 1 名</div></div></div>',2)),e("div",$t,[e("button",{class:"btn-view-ranking",onClick:s[0]||(s[0]=o=>t.$emit("restart"))},"查看排名 >>")])])],512)),[[he,n.show]])}};class Ct{constructor(){this.ws=null,this.clientId=null,this.clientType=null,this.isConnected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=1e3,this.messageHandlers=new Map}connect(t="client"){const s=window.location.protocol==="https:"?"wss:":"ws:",o=window.location.hostname,i=window.location.port||(window.location.protocol==="https:"?"443":"80"),c=`${s}//${o}:${i}`;this.clientType=t;try{this.ws=new WebSocket(c),this.setupEventHandlers()}catch(r){console.error("WebSocket连接失败:",r),this.scheduleReconnect()}}setupEventHandlers(){this.ws.onopen=()=>{console.log("WebSocket连接已建立"),this.isConnected=!0,this.reconnectAttempts=0},this.ws.onmessage=t=>{try{const s=JSON.parse(t.data);this.handleMessage(s)}catch(s){console.error("消息解析错误:",s)}},this.ws.onclose=t=>{console.log("WebSocket连接已关闭:",t.code,t.reason),this.isConnected=!1,t.wasClean||this.scheduleReconnect()},this.ws.onerror=t=>{console.error("WebSocket错误:",t)}}handleMessage(t){console.log("收到消息:",t);const s=this.messageHandlers.get(t.type);s&&s(t.data)}send(t,s={}){if(this.ws&&this.ws.readyState===WebSocket.OPEN){const o={type:t,...s};this.ws.send(JSON.stringify(o))}else console.warn("WebSocket未连接，无法发送消息")}on(t,s){this.messageHandlers.set(t,s)}off(t){this.messageHandlers.delete(t)}joinGame(t,s){this.send("player_join",{name:t,team:s})}updatePlayer(t){this.send("player_update",t)}startGame(t=30){this.send("game_start",{timeLeft:t})}endGame(){this.send("game_end")}resetGame(){this.send("game_reset")}shakeDetected(){this.send("shake_detected")}scheduleReconnect(){this.reconnectAttempts<this.maxReconnectAttempts?(this.reconnectAttempts++,console.log(`尝试重连 (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),setTimeout(()=>{this.connect(this.clientType)},this.reconnectDelay*this.reconnectAttempts)):console.error("达到最大重连次数，停止重连")}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1}getConnectionStatus(){return{isConnected:this.isConnected,clientId:this.clientId,clientType:this.clientType}}}const L=new Ct,Pt={class:"game-container"},Mt={key:0,class:"offline-notice"},Lt={class:"offline-content"},xt={class:"debug-info"},Gt={class:"game-main"},Dt=15,Et=500,It={__name:"GameView",setup(n){const t=J(),s=g(!0),o=g(!1),i=g(!1),c=g("离线模式"),r=g(!0),f=g("检测中..."),w=g("未授权"),u=ae({score:0,timeLeft:30,shakeCount:0,isPlaying:!1,playerId:null,playerName:"zee",playerTeam:"Drivellsten"});let I=0,G=null;const m=()=>{try{L.connect("client"),L.on("connection",d=>{u.playerId=d.clientId,i.value=!0,r.value=!1,c.value="已连接",L.joinGame(u.playerName,u.playerTeam)}),L.on("game_state",d=>{P(d)}),setInterval(()=>{const d=L.getConnectionStatus();i.value=d.isConnected,r.value=!d.isConnected,c.value=d.isConnected?"已连接":"离线模式"},1e3)}catch(v){console.log("WebSocket连接失败，使用离线模式:",v),r.value=!0,c.value="离线模式"}},P=v=>{v.isPlaying!==u.isPlaying&&(u.isPlaying=v.isPlaying,v.isPlaying?_():C()),u.timeLeft=v.timeLeft;const d=v.players.find(A=>A.id===u.playerId);d&&(u.score=d.score,u.shakeCount=Math.floor(d.score/10))},x=()=>{s.value=!1,console.log("用户点击了允许，开始请求权限..."),D(),m()},j=()=>{s.value=!1,t.showMessage("需要权限才能开始游戏")},_=()=>{u.isPlaying=!0,u.score=0,u.shakeCount=0,u.timeLeft=30,t.updateGameStatus("游戏开始！摇动手机收集胡萝卜"),G=setInterval(()=>{u.timeLeft--,u.timeLeft<=0&&C()},1e3)},C=()=>{u.isPlaying=!1,clearInterval(G),t.updateGameStatus("游戏结束"),o.value=!0},M=()=>{o.value=!1,u.score=0,u.shakeCount=0,u.timeLeft=30,t.updateGameStatus("请准备"),document.querySelectorAll(".hidden-rabbit").forEach(v=>{v.style.opacity="0.3",v.classList.remove("jump")})},T=v=>{if(!u.isPlaying)return;const d=v.accelerationIncludingGravity;if(!d)return;const A=d.x,K=d.y,Q=d.z,H=Math.sqrt(A*A+K*K+Q*Q),R=Date.now();H>Dt&&R-I>Et&&(I=R,b())},b=()=>{u.shakeCount++,u.score+=10,!r.value&&i.value&&L.shakeDetected(),t.addShakeAnimation(),t.showRandomRabbit(),u.shakeCount>=10&&C()},a=()=>{const v=A=>{A.code==="Space"&&u.isPlaying&&(A.preventDefault(),b())},d=A=>{u.isPlaying&&A.target.closest(".underground")&&b()};return document.addEventListener("keydown",v),document.addEventListener("click",d),()=>{document.removeEventListener("keydown",v),document.removeEventListener("click",d)}},l=()=>{if(window.DeviceMotionEvent)try{window.addEventListener("devicemotion",T),console.log("摇一摇检测已启用"),t.showMessage("摇一摇检测已启用，可以开始游戏了！")}catch(v){return console.log("摇一摇检测设置失败:",v),t.showMessage("摇一摇检测设置失败，使用模拟模式"),a()}else return console.log("设备不支持DeviceMotion，使用模拟模式"),t.showMessage("设备不支持摇一摇，使用模拟模式"),a()},p=()=>{r.value&&_()},y=()=>{console.log("测试摇一摇功能..."),window.DeviceMotionEvent?(f.value="✅ 支持DeviceMotion API",console.log("✅ 设备支持DeviceMotion API"),t.showMessage("设备支持摇一摇，请摇动手机测试")):(f.value="❌ 不支持DeviceMotion API",console.log("❌ 设备不支持DeviceMotion API"),t.showMessage("设备不支持摇一摇，可使用空格键或点击测试")),b()},S=()=>{if(console.log("🔐 直接测试权限请求..."),!window.DeviceMotionEvent){console.log("❌ 设备不支持DeviceMotion"),t.showMessage("设备不支持摇一摇");return}typeof DeviceMotionEvent.requestPermission=="function"?(console.log("📱 直接调用 requestPermission..."),DeviceMotionEvent.requestPermission().then(v=>{console.log(`权限结果: ${v}`),v==="granted"?(console.log("✅ 权限已授予"),t.showMessage("权限已授予，可以摇一摇了！"),l()):(console.log("❌ 权限被拒绝"),t.showMessage("权限被拒绝，无法使用摇一摇"))}).catch(v=>{console.log("❌ 权限请求失败:",v),t.showMessage("权限请求失败")})):(console.log("📱 设备不支持 requestPermission，需要手动授权..."),t.showMessage("设备不支持自动权限请求，请在浏览器设置中手动允许设备运动权限"))},D=()=>{if(console.log("🔐 开始请求摇一摇权限..."),w.value="请求中...",!window.DeviceMotionEvent){console.log("❌ 设备不支持DeviceMotion"),f.value="❌ 不支持DeviceMotion API",w.value="不适用",a();return}typeof DeviceMotionEvent.requestPermission=="function"?(console.log("📱 使用 requestPermission 方法请求权限..."),DeviceMotionEvent.requestPermission().then(v=>{console.log(`权限结果: ${v}`),v==="granted"?(console.log("✅ DeviceMotion权限已授予"),w.value="已授权",l()):(console.log("❌ DeviceMotion权限被拒绝"),w.value="已拒绝",a())}).catch(v=>{console.log("❌ DeviceMotion权限请求失败:",v),w.value="请求失败",a()})):(console.log("📱 设备不支持 requestPermission，需要用户手动授权..."),w.value="需要手动授权",t.showMessage("请在浏览器设置中手动允许设备运动权限"),a())};return Z(()=>{console.log("游戏组件已挂载，等待用户授权..."),window.DeviceMotionEvent?f.value="✅ 支持DeviceMotion API":f.value="❌ 不支持DeviceMotion API",m()}),ie(()=>{G&&clearInterval(G),window.removeEventListener("devicemotion",T),L.disconnect()}),(v,d)=>(k(),$("div",Pt,[e("div",{class:N(["connection-status",{connected:i.value}])},h(c.value),3),r.value&&!u.isPlaying?(k(),$("div",Mt,[e("div",Lt,[d[5]||(d[5]=e("h3",null,"离线模式",-1)),d[6]||(d[6]=e("p",null,"当前为离线模式，可以测试摇一摇功能",-1)),e("button",{onClick:p,class:"start-btn"}," 开始本地游戏 "),e("button",{onClick:y,class:"debug-btn"}," 测试摇一摇 "),e("button",{onClick:D,class:"permission-btn"}," 请求摇一摇权限 "),e("button",{onClick:S,class:"direct-permission-btn"}," 直接测试权限 "),e("div",xt,[e("p",null,[d[2]||(d[2]=e("strong",null,"设备支持:",-1)),U(" "+h(f.value),1)]),e("p",null,[d[3]||(d[3]=e("strong",null,"权限状态:",-1)),U(" "+h(w.value),1)]),e("p",null,[d[4]||(d[4]=e("strong",null,"摇一摇次数:",-1)),U(" "+h(u.shakeCount),1)])])])])):Ie("",!0),O(Xe),O(Ze),e("div",Gt,[O(ot),O(dt),O(pt)]),O(gt),O(St,{show:s.value,"onUpdate:show":d[0]||(d[0]=A=>s.value=A),onAllow:x,onCancel:j},null,8,["show"]),O(kt,{show:o.value,"onUpdate:show":d[1]||(d[1]=A=>o.value=A),score:v.score,onRestart:M},null,8,["show","score"])]))}},At=te(It,[["__scopeId","data-v-9be9d3a9"]]),Tt=ye("leaderboard",()=>{const n=g([]),t=g("waiting"),s=g(30),o=g(0),i=E(()=>[...n.value].sort((_,C)=>C.score-_.score)),c=E(()=>n.value.filter(_=>_.score>0).length),r=E(()=>{const _=n.value.filter(M=>M.score>0);if(_.length===0)return 0;const C=_.reduce((M,T)=>M+T.score,0);return Math.round(C/_.length)}),f=_=>{n.value.find(M=>M.id===_.id)||n.value.push({id:_.id,name:_.name,team:_.team,score:0,progress:0,track:null})},w=(_,C)=>{const M=n.value.find(T=>T.id===_);M&&(M.score=C,M.progress=Math.min(95,C/100*95),C>o.value&&(o.value=C))},u=()=>{n.value.filter(C=>C.score>0).forEach((C,M)=>{C.track=M+1})},I=()=>{n.value.forEach(_=>{_.score=0,_.progress=0,_.track=null}),o.value=0,s.value=30,t.value="waiting"},G=()=>{t.value="playing",s.value=30,u()},m=()=>{t.value="finished"},P=_=>{s.value=_},x=_=>{const M=i.value.findIndex(T=>T.id===_);return M>=0?M+1:null},j=E(()=>i.value.slice(0,3));return{players:n,gameStatus:t,timeLeft:s,maxScore:o,sortedPlayers:i,totalPlayers:c,averageScore:r,getTopThree:j,addPlayer:f,updatePlayerScore:w,assignTracks:u,resetGame:I,startGame:G,endGame:m,updateTime:P,getPlayerRank:x}}),Rt={class:"leaderboard-container"},jt={class:"header"},Nt={class:"game-status"},Ot={class:"timer"},qt={class:"time"},Wt={class:"race-track"},Vt={class:"track-container"},Ht={class:"track-background"},Bt={class:"houses"},Ft={class:"trees"},Ut={class:"track-number"},zt={class:"player-info"},Jt={class:"player-name"},Kt={class:"player-score"},Qt={class:"leaderboard"},Xt={class:"leaderboard-header"},Yt={class:"total-players"},Zt={class:"leaderboard-list"},es={class:"rank"},ts={class:"player-details"},ss={class:"player-name"},ns={class:"player-team"},os={class:"player-score"},as={class:"player-progress"},is={class:"progress-bar"},ls={class:"control-panel"},cs={class:"control-buttons"},rs=["disabled"],us={class:"game-stats"},ds={class:"stat"},vs={class:"value"},ms={class:"stat"},hs={class:"value"},fs={class:"stat"},ps={class:"value"},_s={__name:"LeaderboardView",setup(n){Tt();const t=g(!1),s=g(30),o=g("waiting"),i=g("等待开始"),c=g(!1),r=g("连接中..."),f=ae(Array.from({length:8},(b,a)=>({id:a+1,player:null,progress:0}))),w=g([]),u=E(()=>[...w.value].sort((b,a)=>a.score-b.score)),I=E(()=>w.value.filter(b=>b.score>0).length),G=E(()=>Math.max(...w.value.map(b=>b.score),0)),m=E(()=>{const b=w.value.filter(l=>l.score>0);if(b.length===0)return 0;const a=b.reduce((l,p)=>l+p.score,0);return Math.round(a/b.length)}),P=b=>{const a=Math.floor(b/60),l=b%60;return`${a.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`},x=()=>{L.connect("leaderboard"),L.on("connection",a=>{c.value=!0,r.value="已连接",a.gameState&&j(a.gameState)}),L.on("game_state",a=>{j(a)}),setInterval(()=>{const a=L.getConnectionStatus();c.value=a.isConnected,r.value=a.isConnected?"已连接":"连接断开"},1e3)},j=b=>{t.value=b.isPlaying,s.value=b.timeLeft,b.isPlaying?(o.value="playing",i.value="游戏进行中"):(o.value="waiting",i.value="等待开始"),w.value=b.players||[],_()},_=()=>{f.forEach((b,a)=>{const l=w.value.find(p=>p.track===a+1);b.player=l||null,b.progress=l?l.progress:0})},C=()=>{t.value||L.startGame(30)},M=()=>{L.resetGame()},T=()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen()};return Z(()=>{x()}),ie(()=>{L.disconnect()}),(b,a)=>(k(),$("div",Rt,[e("div",{class:N(["connection-status",{connected:c.value}])},h(r.value),3),e("div",jt,[a[1]||(a[1]=e("div",{class:"title"},[e("h1",null,"兔飞猛进 - 实时排行榜"),e("div",{class:"subtitle"},"实时显示所有参赛选手的摇一摇积分排名")],-1)),e("div",Nt,[e("div",{class:N(["status-indicator",o.value])},h(i.value),3),e("div",Ot,[a[0]||(a[0]=e("span",{class:"icon"},"⏰",-1)),e("span",qt,h(P(s.value)),1)])])]),e("div",Wt,[a[4]||(a[4]=e("div",{class:"sky"},[e("div",{class:"clouds"}),e("div",{class:"birds"})],-1)),a[5]||(a[5]=e("div",{class:"mountains"},null,-1)),e("div",Vt,[(k(!0),$(q,null,W(f,(l,p)=>{var y,S;return k(),$("div",{class:"track",key:p,style:F({top:`${p*80+100}px`})},[e("div",Ht,[e("div",Bt,[(k(),$(q,null,W(8,D=>e("div",{class:"house",key:D})),64))]),e("div",Ft,[(k(),$(q,null,W(6,D=>e("div",{class:"tree",key:D})),64))])]),e("div",Ut,h(p+1),1),e("div",{class:N(["player-rabbit",{active:l.player}]),style:F({left:`${l.progress}%`})},[a[2]||(a[2]=e("div",{class:"rabbit-avatar"},[e("div",{class:"rabbit-body"}),e("div",{class:"rabbit-ears"}),e("div",{class:"rabbit-face"})],-1)),e("div",zt,[e("div",Jt,h(((y=l.player)==null?void 0:y.name)||"等待加入"),1),e("div",Kt,h(((S=l.player)==null?void 0:S.score)||0)+"分",1)])],6),a[3]||(a[3]=e("div",{class:"finish-line"},null,-1))],4)}),128))])]),e("div",Qt,[e("div",Xt,[a[6]||(a[6]=e("h2",null,"实时排行榜",-1)),e("div",Yt,"参赛人数: "+h(I.value),1)]),e("div",Zt,[(k(!0),$(q,null,W(u.value,(l,p)=>(k(),$("div",{class:N(["leaderboard-item",{"top-3":p<3}]),key:l.id},[e("div",es,h(p+1),1),a[7]||(a[7]=e("div",{class:"player-avatar"},[e("div",{class:"mini-rabbit"})],-1)),e("div",ts,[e("div",ss,h(l.name),1),e("div",ns,h(l.team),1)]),e("div",os,h(l.score)+"分",1),e("div",as,[e("div",is,[e("div",{class:"progress-fill",style:F({width:`${l.score/G.value*100}%`})},null,4)])])],2))),128))])]),e("div",ls,[e("div",cs,[e("button",{class:"btn btn-primary",onClick:C,disabled:t.value},h(t.value?"游戏进行中":"开始游戏"),9,rs),e("button",{class:"btn btn-secondary",onClick:M}," 重置游戏 "),e("button",{class:"btn btn-info",onClick:T}," 全屏显示 ")]),e("div",us,[e("div",ds,[a[8]||(a[8]=e("span",{class:"label"},"最高分:",-1)),e("span",vs,h(G.value)+"分",1)]),e("div",ms,[a[9]||(a[9]=e("span",{class:"label"},"平均分:",-1)),e("span",hs,h(m.value)+"分",1)]),e("div",fs,[a[10]||(a[10]=e("span",{class:"label"},"剩余时间:",-1)),e("span",ps,h(P(s.value)),1)])])])]))}},gs=te(_s,[["__scopeId","data-v-759ecc6b"]]),bs={class:"admin-container"},ys={class:"admin-panel"},Ss={class:"panel-header"},ws={class:"game-status"},$s={class:"control-section"},ks={class:"control-buttons"},Cs=["disabled"],Ps=["disabled"],Ms={class:"settings-section"},Ls={class:"setting-item"},xs=["disabled"],Gs={class:"setting-item"},Ds=["disabled"],Es={class:"stats-section"},Is={class:"stats-grid"},As={class:"stat-card"},Ts={class:"stat-value"},Rs={class:"stat-card"},js={class:"stat-value"},Ns={class:"stat-card"},Os={class:"stat-value"},qs={class:"stat-card"},Ws={class:"stat-value"},Vs={class:"players-section"},Hs={class:"players-list"},Bs={class:"player-info"},Fs={class:"player-name"},Us={class:"player-team"},zs={class:"player-stats"},Js={class:"player-score"},Ks={class:"player-progress"},Qs={class:"progress-bar"},Xs={class:"system-section"},Ys={class:"system-info"},Zs={class:"info-item"},en={class:"info-item"},tn={class:"value"},sn={class:"info-item"},nn={class:"value"},on={__name:"AdminView",setup(n){const t=g(!1),s=g(30),o=g(!1),i=g("连接中..."),c=g("--:--"),r=g(30),f=g(500),w=g([]),u=E(()=>t.value?"游戏进行中":"等待开始"),I=E(()=>t.value?"playing":"waiting"),G=E(()=>w.value.length),m=E(()=>w.value.filter(a=>a.score>0).length),P=E(()=>Math.max(...w.value.map(a=>a.score),0)),x=E(()=>{const a=w.value.filter(p=>p.score>0);if(a.length===0)return 0;const l=a.reduce((p,y)=>p+y.score,0);return Math.round(l/a.length)}),j=a=>{const l=Math.floor(a/60),p=a%60;return`${l.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`},_=()=>{L.connect("admin"),L.on("connection",l=>{o.value=!0,i.value="已连接",c.value=new Date().toLocaleTimeString(),l.gameState&&C(l.gameState)}),L.on("game_state",l=>{C(l)}),setInterval(()=>{const l=L.getConnectionStatus();o.value=l.isConnected,i.value=l.isConnected?"已连接":"连接断开"},1e3)},C=a=>{t.value=a.isPlaying,s.value=a.timeLeft,w.value=a.players||[]},M=()=>{L.startGame(r.value)},T=()=>{L.endGame()},b=()=>{L.resetGame()};return Z(()=>{_()}),ie(()=>{L.disconnect()}),(a,l)=>(k(),$("div",bs,[e("div",{class:N(["connection-status",{connected:o.value}])},h(i.value),3),e("div",ys,[e("div",Ss,[l[3]||(l[3]=e("h1",null,"游戏管理员控制台",-1)),e("div",ws,[l[2]||(l[2]=e("span",{class:"status-label"},"游戏状态:",-1)),e("span",{class:N(["status-value",I.value])},h(u.value),3)])]),e("div",$s,[l[4]||(l[4]=e("h2",null,"游戏控制",-1)),e("div",ks,[e("button",{class:"btn btn-start",onClick:M,disabled:t.value}," 🎮 开始游戏 ",8,Cs),e("button",{class:"btn btn-stop",onClick:T,disabled:!t.value}," ⏹️ 结束游戏 ",8,Ps),e("button",{class:"btn btn-reset",onClick:b}," 🔄 重置游戏 ")])]),e("div",Ms,[l[7]||(l[7]=e("h2",null,"游戏设置",-1)),e("div",Ls,[l[5]||(l[5]=e("label",null,"游戏时长 (秒):",-1)),Y(e("input",{type:"number","onUpdate:modelValue":l[0]||(l[0]=p=>r.value=p),min:"10",max:"300",disabled:t.value},null,8,xs),[[ce,r.value]])]),e("div",Gs,[l[6]||(l[6]=e("label",null,"摇一摇冷却时间 (毫秒):",-1)),Y(e("input",{type:"number","onUpdate:modelValue":l[1]||(l[1]=p=>f.value=p),min:"100",max:"2000",disabled:t.value},null,8,Ds),[[ce,f.value]])])]),e("div",Es,[l[12]||(l[12]=e("h2",null,"实时统计",-1)),e("div",Is,[e("div",As,[e("div",Ts,h(G.value),1),l[8]||(l[8]=e("div",{class:"stat-label"},"在线玩家",-1))]),e("div",Rs,[e("div",js,h(m.value),1),l[9]||(l[9]=e("div",{class:"stat-label"},"活跃玩家",-1))]),e("div",Ns,[e("div",Os,h(P.value),1),l[10]||(l[10]=e("div",{class:"stat-label"},"最高分数",-1))]),e("div",qs,[e("div",Ws,h(x.value),1),l[11]||(l[11]=e("div",{class:"stat-label"},"平均分数",-1))])])]),e("div",Vs,[l[13]||(l[13]=e("h2",null,"在线玩家",-1)),e("div",Hs,[(k(!0),$(q,null,W(w.value,p=>(k(),$("div",{class:"player-item",key:p.id},[e("div",Bs,[e("div",Fs,h(p.name),1),e("div",Us,h(p.team),1)]),e("div",zs,[e("div",Js,h(p.score)+"分",1),e("div",Ks,[e("div",Qs,[e("div",{class:"progress-fill",style:F({width:`${p.progress}%`})},null,4)])])])]))),128))])]),e("div",Xs,[l[17]||(l[17]=e("h2",null,"系统信息",-1)),e("div",Ys,[e("div",Zs,[l[14]||(l[14]=e("span",{class:"label"},"服务器状态:",-1)),e("span",{class:N(["value",{online:o.value}])},h(o.value?"在线":"离线"),3)]),e("div",en,[l[15]||(l[15]=e("span",{class:"label"},"连接时间:",-1)),e("span",tn,h(c.value),1)]),e("div",sn,[l[16]||(l[16]=e("span",{class:"label"},"剩余时间:",-1)),e("span",nn,h(j(s.value)),1)])])])])]))}},an=te(on,[["__scopeId","data-v-9cf78069"]]),ln=[{path:"/",name:"Game",component:At,meta:{title:"兔飞猛进 - 游戏客户端"}},{path:"/leaderboard",name:"Leaderboard",component:gs,meta:{title:"兔飞猛进 - 大屏终端"}},{path:"/admin",name:"Admin",component:an,meta:{title:"兔飞猛进 - 管理员控制台"}}],Se=Ae({history:Te(),routes:ln});Se.beforeEach((n,t,s)=>{n.meta.title&&(document.title=n.meta.title),s()});const le=Re(Je),cn=je();le.use(cn);le.use(Se);le.mount("#app");
